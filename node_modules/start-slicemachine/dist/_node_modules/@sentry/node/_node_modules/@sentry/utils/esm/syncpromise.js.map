{"version":3,"file":"syncpromise.js","sources":["../../../../../../../../../../node_modules/@sentry/node/node_modules/@sentry/utils/esm/syncpromise.js"],"sourcesContent":["import { isThenable } from './is.js';\n\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n\n/** SyncPromise internal states */\nvar States; (function (States) {\n  /** Pending */\n  const PENDING = 0; States[States[\"PENDING\"] = PENDING] = \"PENDING\";\n  /** Resolved / OK */\n  const RESOLVED = 1; States[States[\"RESOLVED\"] = RESOLVED] = \"RESOLVED\";\n  /** Rejected / Error */\n  const REJECTED = 2; States[States[\"REJECTED\"] = REJECTED] = \"REJECTED\";\n})(States || (States = {}));\n\n// Overloads so we can call resolvedSyncPromise without arguments and generic argument\n\n/**\n * Creates a resolved sync promise.\n *\n * @param value the value to resolve the promise with\n * @returns the resolved sync promise\n */\nfunction resolvedSyncPromise(value) {\n  return new SyncPromise(resolve => {\n    resolve(value);\n  });\n}\n\n/**\n * Creates a rejected sync promise.\n *\n * @param value the value to reject the promise with\n * @returns the rejected sync promise\n */\nfunction rejectedSyncPromise(reason) {\n  return new SyncPromise((_, reject) => {\n    reject(reason);\n  });\n}\n\n/**\n * Thenable class that behaves like a Promise and follows it's interface\n * but is not async internally\n */\nclass SyncPromise {\n\n   constructor(\n    executor,\n  ) {SyncPromise.prototype.__init.call(this);SyncPromise.prototype.__init2.call(this);SyncPromise.prototype.__init3.call(this);SyncPromise.prototype.__init4.call(this);\n    this._state = States.PENDING;\n    this._handlers = [];\n\n    try {\n      executor(this._resolve, this._reject);\n    } catch (e) {\n      this._reject(e);\n    }\n  }\n\n  /** JSDoc */\n   then(\n    onfulfilled,\n    onrejected,\n  ) {\n    return new SyncPromise((resolve, reject) => {\n      this._handlers.push([\n        false,\n        result => {\n          if (!onfulfilled) {\n            // TODO: ¯\\_(ツ)_/¯\n            // TODO: FIXME\n            resolve(result );\n          } else {\n            try {\n              resolve(onfulfilled(result));\n            } catch (e) {\n              reject(e);\n            }\n          }\n        },\n        reason => {\n          if (!onrejected) {\n            reject(reason);\n          } else {\n            try {\n              resolve(onrejected(reason));\n            } catch (e) {\n              reject(e);\n            }\n          }\n        },\n      ]);\n      this._executeHandlers();\n    });\n  }\n\n  /** JSDoc */\n   catch(\n    onrejected,\n  ) {\n    return this.then(val => val, onrejected);\n  }\n\n  /** JSDoc */\n   finally(onfinally) {\n    return new SyncPromise((resolve, reject) => {\n      let val;\n      let isRejected;\n\n      return this.then(\n        value => {\n          isRejected = false;\n          val = value;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n        reason => {\n          isRejected = true;\n          val = reason;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n      ).then(() => {\n        if (isRejected) {\n          reject(val);\n          return;\n        }\n\n        resolve(val );\n      });\n    });\n  }\n\n  /** JSDoc */\n    __init() {this._resolve = (value) => {\n    this._setResult(States.RESOLVED, value);\n  };}\n\n  /** JSDoc */\n    __init2() {this._reject = (reason) => {\n    this._setResult(States.REJECTED, reason);\n  };}\n\n  /** JSDoc */\n    __init3() {this._setResult = (state, value) => {\n    if (this._state !== States.PENDING) {\n      return;\n    }\n\n    if (isThenable(value)) {\n      void (value ).then(this._resolve, this._reject);\n      return;\n    }\n\n    this._state = state;\n    this._value = value;\n\n    this._executeHandlers();\n  };}\n\n  /** JSDoc */\n    __init4() {this._executeHandlers = () => {\n    if (this._state === States.PENDING) {\n      return;\n    }\n\n    const cachedHandlers = this._handlers.slice();\n    this._handlers = [];\n\n    cachedHandlers.forEach(handler => {\n      if (handler[0]) {\n        return;\n      }\n\n      if (this._state === States.RESOLVED) {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        handler[1](this._value );\n      }\n\n      if (this._state === States.REJECTED) {\n        handler[2](this._value);\n      }\n\n      handler[0] = true;\n    });\n  };}\n}\n\nexport { SyncPromise, rejectedSyncPromise, resolvedSyncPromise };\n//# sourceMappingURL=syncpromise.js.map\n"],"names":["States"],"mappings":"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","x_google_ignoreList":[0]}