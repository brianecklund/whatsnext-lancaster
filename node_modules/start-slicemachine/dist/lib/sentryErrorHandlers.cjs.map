{"version":3,"file":"sentryErrorHandlers.cjs","sources":["../../../src/lib/sentryErrorHandlers.ts"],"sourcesContent":["import type { ErrorRequestHandler } from \"express\";\nimport * as Sentry from \"@sentry/node\";\n\nimport {\n\tCreateSliceMachineManagerMiddlewareArgs,\n\tUnauthenticatedError,\n\tUnauthorizedError,\n\tInferSliceAbortError,\n} from \"@slicemachine/manager\";\n\nimport { checkIsSentryEnabled } from \"./checkIsSentryEnabled\";\n\nexport const node = (name: string, error: unknown): void => {\n\tif (checkIsSentryEnabled()) {\n\t\tif (\n\t\t\terror instanceof UnauthenticatedError ||\n\t\t\terror instanceof UnauthorizedError ||\n\t\t\terror instanceof InferSliceAbortError\n\t\t) {\n\t\t\t// noop - No need to track this error in Sentry.\n\t\t\t// 1. User is not logged in or does not have access to the repository\n\t\t\t// 2. Infer slice was aborted by the user, not an error\n\t\t} else {\n\t\t\tSentry.withScope(function (scope) {\n\t\t\t\tscope.setTransactionName(name);\n\t\t\t\tSentry.captureException(error, {\n\t\t\t\t\t...(error instanceof Error ? { extra: { cause: error.cause } } : {}),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n};\n\nexport const server: ErrorRequestHandler = (error, req, _res, next): void => {\n\tnode(req.path, error);\n\tnext();\n};\n\nexport const rpc: CreateSliceMachineManagerMiddlewareArgs[\"onError\"] = (\n\targs,\n) => {\n\tnode(args.procedurePath.join(\".\"), args.error);\n};\n"],"names":["UnauthenticatedError","UnauthorizedError","InferSliceAbortError","Sentry.withScope","Sentry.captureException"],"mappings":";;;;AAYO,MAAM,OAAO,CAAC,MAAc,UAAwB;AAC9B;AAC3B,QACC,iBAAiBA,QAAAA,wBACjB,iBAAiBC,QAAAA,qBACjB,iBAAiBC,QAAAA,qBAChB;AAAA,SAIK;AACNC,gBAAAA,UAAiB,SAAU,OAAK;AAC/B,cAAM,mBAAmB,IAAI;AAC7BC,kBAAAA,iBAAwB,OAAO;AAAA,UAC9B,GAAI,iBAAiB,QAAQ,EAAE,OAAO,EAAE,OAAO,MAAM,MAAA,MAAY,CAAA;AAAA,QAAA,CACjE;AAAA,MACF,CAAC;AAAA,IACF;AAAA,EACD;AACD;AAEO,MAAM,SAA8B,CAAC,OAAO,KAAK,MAAM,SAAc;AAC3E,OAAK,IAAI,MAAM,KAAK;AACpB,OAAA;AACD;AAEO,MAAM,MAA0D,CACtE,SACG;AACH,OAAK,KAAK,cAAc,KAAK,GAAG,GAAG,KAAK,KAAK;AAC9C;;;;"}